services:
  claude-bot:
    build: .
    container_name: claude_agent
    restart: always
    env_file: .env
    environment:
      # SSH configuration for Docker management on host
      # These can be overridden in .env file
      - SSH_HOST=${SSH_HOST:-host.docker.internal}
      - SSH_PORT=${SSH_PORT:-22}
      - SSH_KEY_PATH=${SSH_KEY_PATH:-/app/bot_key}
    volumes:
      # SSH private key for host access (read-only)
      # Generate with: ssh-keygen -t ed25519 -f ./bot_key -N ""
      # Add public key to host: cat ./bot_key.pub >> ~/.ssh/authorized_keys
      - ./bot_key:/app/bot_key:ro
      # Persistent storage for database and logs
      - ./data:/app/data
      - ./logs:/app/logs
      # Projects directory - persists across container rebuilds
      - ./projects:/root/projects
      # Claude Code sessions - preserves conversation history and context compression
      - ./claude_sessions:/root/.claude
      # Claude Account credentials (optional - for OAuth auth instead of API key)
      # Get this file by running `claude` locally and authenticating via browser
      # The claude-agent-sdk reads from ~/.config/claude/config.json
      - ./claude_config:/root/.config/claude:ro
    extra_hosts:
      # Allows container to connect to host machine via SSH
      - "host.docker.internal:host-gateway"
